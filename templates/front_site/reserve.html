{% extends "front_site/base.html" %}
{% load static %}

<cfif NOT (IsDefined("URL.vid") AND IsNumeric(URL.vid)) AND NOT IsDefined("Form.vehicleid")>
    <cflocation url="#OnSite#fleet.cfm">
    <CFABORT>
</cfif>

<!--- If a form was submitted, the user had JS turned off, so we have to process the sequential logic. --->
<cfset fieldErrors = StructNew()>
<cfset formError = "">
<cfif IsDefined("Form.reservation_type")>

    <!--- Validate the first page (identity and rental date/specs) --->
    <cfset ret = StructAppend(Form, Variables)>
    <cfinvoke
        component="cfc/porknbeans"
        method="validateRentalIdentity"
        returnVariable="IdentityResult"
        argumentCollection="#Form#">
    </cfinvoke>
    <cfset fieldErrors = IdentityResult.fieldErrors>
    <cfset Form.taxpct = IdentityResult.success ? IdentityResult.tax_rate : "">

    <!--- If the user entered a recognized email address, validate it against the password --->
    <cfif IsDefined("IdentityResult.customerid") AND IdentityResult.customerid GT 0>
        <cfset Form.customerid = IdentityResult.customerid>
        <cfset Form.login_pass = Form.inline_pass>
        <cfinvoke
            component="cfc/porknbeans"
            method="validateLogin"
            returnVariable="LoginResult"
            argumentCollection="#Form#">
        </cfinvoke>
        <cfset ret = StructAppend(fieldErrors, LoginResult.fieldErrors)>
    </cfif>

    <!--- If the "Complete Reservation" button was pressed OR if the login (above) was successful, validate the payment form and create the reservation --->
    <cfif IsDefined("Form.payment_btn") OR (IsDefined("LoginResult") AND LoginResult.success)>
        <cfinvoke
            component="cfc/porknbeans"
            method="validateRentalPayment"
            returnVariable="ReservationResult"
            argumentCollection="#Form#">
        </cfinvoke>
        <cfset ret = StructAppend(fieldErrors, ReservationResult.fieldErrors)>

        <!--- Push to customer portal if successful --->
        <cfif ReservationResult.success>
            <cfset redirectUrl = ReservationResult.custsite & "reserve_confirm.cfm?confcode=" & ReservationResult.confcode>
            <cflocation url=#redirectUrl#>
        </cfif>

    </cfif>

    <!--- We're still here, so bind the form variables for redisplay --->
    <cfset Reservation = Form>
    <cfset formError = NOT IdentityResult.success ? IdentityResult.error :
        IsDefined("LoginResult") AND NOT LoginResult.success ? LoginResult.error :
        IsDefined("ReservationResult") AND NOT ReservationResult.success ? ReservationResult.error : "">

<!--- If the user has JS on, pull a blank Reservation object to populate the form --->
<cfelse>

    <cfquery name="Reservation" datasource="#DSN#">
        SELECT reservationid,Reservations.customerid,fname,lname,email,hphone,wphone,mphone,fax,
        Reservations.vehicleid,make,model,year,reservdate,numdays,dateout,dateback,delivery,
        rate,drivers,milesinc,xtramiles,Reservations.notes,coupon,Reservations.status,depamount,confcode,
        Reservations.reglong,Reservations.reglat,iphone,markid,discount,0 as extramiles,
        ccnum,ccexpmo,ccexpyr,cccvv,cctel,addr,city,state,zip,'' AS inline_pass,'' AS deliveryzip,
        dateout AS dateouttime,dateback AS datebacktime FROM Reservations
        INNER JOIN Customers ON Customers.customerid=Reservations.customerid
        INNER JOIN Vehicles ON Vehicles.vehicleid=Reservations.vehicleid
        WHERE reservationid = 0
    </cfquery>

</cfif>

<cfset vid = IsDefined("Form.vehicleid") ? Form.vehicleid : URL.vid>

<cfquery name="Vehicle" datasource="#DSN#">
    SELECT vehicleid,make,model,status,redirect FROM Vehicles
    WHERE vehicleid = <CFQUERYPARAM value="#vid#" CFSQLType="CF_SQL_INTEGER">
    AND status = 1
</cfquery>
<CFIF Vehicle.redirect GT 0>
    <CFLOCATION URL="reserve.cfm?vid=#Vehicle.redirect#">
    <CFABORT>
</CFIF>

<cfquery name="VehicleFront" datasource="#FDSN#">
    SELECT milesinc,deposit FROM VehiclesFront
    WHERE vehicleid = <CFQUERYPARAM value="#vid#" CFSQLType="CF_SQL_INTEGER">
</cfquery>

<CFIF Vehicle.recordCount IS 0>
    <CFLOCATION URL="#OnSite#fleet.cfm">
    <CFABORT>
</CFIF>

<CFINCLUDE TEMPLATE="inc_states.cfm">
<CFINCLUDE TEMPLATE="inc_header.cfm">
<title>Performance Rentals</title>
<CFINCLUDE TEMPLATE="inc_meta.cfm">
<CFINCLUDE TEMPLATE="inc_styles.cfm">
<CFINCLUDE TEMPLATE="inc_js.cfm">
</head>
<body>

<div class="wrapper">

<CFINCLUDE TEMPLATE="inc_nav.cfm">

<section class="l-content">

{% block content %}
<div class="l-container">
<div class="well" style="padding-bottom: 100px;">
    <div class='section-header'>Reserve Your Vehicle</div>

    <CFQUERY NAME="tPics" DATASOURCE="#FDSN#">
        SELECT vpicsid,vehicleid,fext,isfirst FROM VPics
        WHERE vehicleid = <CFQUERYPARAM value="#Vehicle.vehicleid#" CFSQLType="CF_SQL_INTEGER">
        ORDER BY RAND()
        LIMIT 5
    </CFQUERY>
    <div class="reservation-pics-sidebar">
        <cfoutput query="tPics">
            <img src="pics/PRI-#vpicsid#.#fext#" />
        </cfoutput>
    </div>

    <cfform method="POST" name="reservation_form" action="reserve.cfm" onsubmit="return false;" autocomplete="on">
    <cfoutput query="Vehicle">

    <div class="reservation-form-sidebar">

    <cfif Len(formError) GT 0>
    <div class="exception" id="reservation_form_error">
        <h3>An error occurred</h3>
        <p class="alert-message">#formError#</p>
    </div>
    </cfif>

    <div id="reservation_identity">

        <p class="reservation-info">
        We're glad to have you renting from us! Please give us some information on your needs: the
        date of the rental, the date when you'll be bringing the vehicle back, and any notes or special requests
        (such as whether you'll need the vehicle delivered or whether you'll be picking it up at PRI).
        </p>

        <table class="inputform identity">
            <tr>
                <td>Vehicle</td>
                <td><cfinput name="vehicleid" type="hidden" value="#vid#" />#make# #model#</td>
            </tr>
            <tr>
                <td>Rental Date</td>
                <td>
                    <cfinput name="dateout" value="#Reservation.dateout#" style="width: 120px;" placeholder="MM/DD/YYYY" class="#StructKeyExists(fieldErrors,"dateout") ? 'field-error' : ''#" />
                    <cfselect name="dateouttime" class="#StructKeyExists(fieldErrors,"dateouttime") ? 'field-error' : ''#">
                        <option value="07:00" <cfif Reservation.dateouttime IS "07:00">selected</cfif>>7:00 am</option>
                        <option value="07:30" <cfif Reservation.dateouttime IS "07:30">selected</cfif>>7:30 am</option>
                        <option value="08:00" <cfif Reservation.dateouttime IS "08:00">selected</cfif>>8:00 am</option>
                        <option value="08:30" <cfif Reservation.dateouttime IS "08:30">selected</cfif>>8:30 am</option>
                        <option value="09:00" <cfif Reservation.dateouttime IS "09:00">selected</cfif>>9:00 am</option>
                        <option value="09:30" <cfif Reservation.dateouttime IS "09:30">selected</cfif>>9:30 am</option>
                        <option value="10:00" <cfif Reservation.dateouttime IS "10:00">selected</cfif>>10:00 am</option>
                        <option value="10:30" <cfif Reservation.dateouttime IS "10:30">selected</cfif>>10:30 am</option>
                        <option value="11:00" <cfif Reservation.dateouttime IS "11:00">selected</cfif>>11:00 am</option>
                        <option value="11:30" <cfif Reservation.dateouttime IS "11:30">selected</cfif>>11:30 am</option>
                        <option value="12:00" <cfif Reservation.dateouttime IS "12:00">selected</cfif>>12:00 pm</option>
                        <option value="12:30" <cfif Reservation.dateouttime IS "12:30">selected</cfif>>12:30 pm</option>
                        <option value="13:00" <cfif Reservation.dateouttime IS "13:00">selected</cfif>>1:00 pm</option>
                        <option value="13:30" <cfif Reservation.dateouttime IS "13:30">selected</cfif>>1:30 pm</option>
                        <option value="14:00" <cfif Reservation.dateouttime IS "14:00">selected</cfif>>2:00 pm</option>
                        <option value="14:30" <cfif Reservation.dateouttime IS "14:30">selected</cfif>>2:30 pm</option>
                        <option value="15:00" <cfif Reservation.dateouttime IS "15:00">selected</cfif>>3:00 pm</option>
                        <option value="15:30" <cfif Reservation.dateouttime IS "15:30">selected</cfif>>3:30 pm</option>
                        <option value="16:00" <cfif Reservation.dateouttime IS "16:00">selected</cfif>>4:00 pm</option>
                        <option value="16:30" <cfif Reservation.dateouttime IS "16:30">selected</cfif>>4:30 pm</option>
                        <option value="17:00" <cfif Reservation.dateouttime IS "17:00">selected</cfif>>5:00 pm</option>
                        <option value="17:30" <cfif Reservation.dateouttime IS "17:30">selected</cfif>>5:30 pm</option>
                        <option value="18:00" <cfif Reservation.dateouttime IS "18:00">selected</cfif>>6:00 pm</option>
                        <option value="18:30" <cfif Reservation.dateouttime IS "18:30">selected</cfif>>6:30 pm</option>
                        <option value="19:00" <cfif Reservation.dateouttime IS "19:00">selected</cfif>>7:00 pm</option>
                        <option value="19:30" <cfif Reservation.dateouttime IS "19:30">selected</cfif>>7:30 pm</option>
                        <option value="20:00" <cfif Reservation.dateouttime IS "20:00">selected</cfif>>8:00 pm</option>
                        <option value="23:00" <cfif Reservation.dateouttime IS "23:00">selected</cfif>>Other (special)</option>
                    </cfselect>
                </td>
            </tr>
            <tr>
                <td>Return Date</td>
                <td>
                    <cfinput name="dateback" value="#Reservation.dateback#" style="width: 120px;" placeholder="MM/DD/YYYY" class="#StructKeyExists(fieldErrors,"dateback") ? 'field-error' : ''#" />
                    <cfselect name="datebacktime" class="#StructKeyExists(fieldErrors,"datebacktime") ? 'field-error' : ''#">
                        <option value="07:00" <cfif Reservation.datebacktime IS "07:00">selected</cfif>>7:00 am</option>
                        <option value="07:30" <cfif Reservation.datebacktime IS "07:30">selected</cfif>>7:30 am</option>
                        <option value="08:00" <cfif Reservation.datebacktime IS "08:00">selected</cfif>>8:00 am</option>
                        <option value="08:30" <cfif Reservation.datebacktime IS "08:30">selected</cfif>>8:30 am</option>
                        <option value="09:00" <cfif Reservation.datebacktime IS "09:00">selected</cfif>>9:00 am</option>
                        <option value="09:30" <cfif Reservation.datebacktime IS "09:30">selected</cfif>>9:30 am</option>
                        <option value="10:00" <cfif Reservation.datebacktime IS "10:00">selected</cfif>>10:00 am</option>
                        <option value="10:30" <cfif Reservation.datebacktime IS "10:30">selected</cfif>>10:30 am</option>
                        <option value="11:00" <cfif Reservation.datebacktime IS "11:00">selected</cfif>>11:00 am</option>
                        <option value="11:30" <cfif Reservation.datebacktime IS "11:30">selected</cfif>>11:30 am</option>
                        <option value="12:00" <cfif Reservation.datebacktime IS "12:00">selected</cfif>>12:00 pm</option>
                        <option value="12:30" <cfif Reservation.datebacktime IS "12:30">selected</cfif>>12:30 pm</option>
                        <option value="13:00" <cfif Reservation.datebacktime IS "13:00">selected</cfif>>1:00 pm</option>
                        <option value="13:30" <cfif Reservation.datebacktime IS "13:30">selected</cfif>>1:30 pm</option>
                        <option value="14:00" <cfif Reservation.datebacktime IS "14:00">selected</cfif>>2:00 pm</option>
                        <option value="14:30" <cfif Reservation.datebacktime IS "14:30">selected</cfif>>2:30 pm</option>
                        <option value="15:00" <cfif Reservation.datebacktime IS "15:00">selected</cfif>>3:00 pm</option>
                        <option value="15:30" <cfif Reservation.datebacktime IS "15:30">selected</cfif>>3:30 pm</option>
                        <option value="16:00" <cfif Reservation.datebacktime IS "16:00">selected</cfif>>4:00 pm</option>
                        <option value="16:30" <cfif Reservation.datebacktime IS "16:30">selected</cfif>>4:30 pm</option>
                        <option value="17:00" <cfif Reservation.datebacktime IS "17:00">selected</cfif>>5:00 pm</option>
                        <option value="17:30" <cfif Reservation.datebacktime IS "17:30">selected</cfif>>5:30 pm</option>
                        <option value="18:00" <cfif Reservation.datebacktime IS "18:00">selected</cfif>>6:00 pm</option>
                        <option value="18:30" <cfif Reservation.datebacktime IS "18:30">selected</cfif>>6:30 pm</option>
                        <option value="19:00" <cfif Reservation.datebacktime IS "19:00">selected</cfif>>7:00 pm</option>
                        <option value="19:30" <cfif Reservation.datebacktime IS "19:30">selected</cfif>>7:30 pm</option>
                        <option value="20:00" <cfif Reservation.datebacktime IS "20:00">selected</cfif>>8:00 pm</option>
                        <option value="23:00" <cfif Reservation.datebacktime IS "23:00">selected</cfif>>Other (special)</option>
                    </cfselect>
                </td>
            </tr>
            <tr>
                <td>Number of Drivers</td>
                <td>
                    <cfselect name="drivers" class="#StructKeyExists(fieldErrors,"drivers") ? 'field-error' : ''#">
                        <option value="1" <cfif Reservation.drivers IS 1>selected</cfif>>1</option>
                        <option value="2" <cfif Reservation.drivers IS 2>selected</cfif>>2</option>
                        <option value="3" <cfif Reservation.drivers IS 3>selected</cfif>>More than 2</option>
                    </cfselect>
                </td>
            </tr>
            <tr>
                <td>Delivery</td>
                <td>
                    <cfselect name="delivery" class="#StructKeyExists(fieldErrors,"delivery") ? 'field-error' : ''#" onchange="toggleDeliveryZip();">
                        <option value="0" <cfif Reservation.delivery IS 0>selected</cfif>>I will be picking up the vehicle at PRI in Ringwood, NJ</option>
                        <option value="1" <cfif Reservation.delivery IS 1>selected</cfif>>I would like the vehicle to be delivered to me</option>
                    </cfselect>
                </td>
            </tr>
            <tr class="delivery-zip">
                <td>Delivery ZIP</td>
                <td><cfinput name="deliveryzip" value="#Reservation.deliveryzip#" style="width: 100px;" maxlength="10" class="#StructKeyExists(fieldErrors,"deliveryzip") ? 'field-error' : ''#" /></td>
            </tr>
            <tr class="smallprint">
                <td></td>
                <td>
                    <small class="subtext delivery-pricing tooltip" title="pricing">See delivery pricing <span class="ui-icon ui-icon-info"></span></small>
                </td>
            </tr>
            <tr>
                <td>Included Miles</td>
                <td>#VehicleFront.milesinc# per day</td>
            </tr>
            <tr>
                <td>Extra miles</td>
                <td>
                    <cfselect name="extramiles" class="#StructKeyExists(fieldErrors,"extramiles") ? 'field-error' : ''#">
                        <cfloop from="1" to="#arrayLen(extraMilesPrices)#" index="i">
                            <cfset milesChoice = extraMilesPrices[i]>
                            <option value="#milesChoice.value#" <cfif Reservation.extramiles IS milesChoice.value>selected</cfif>>#milesChoice.label#</option>
                        </cfloop>
                    </cfselect>
                    <small class="tooltip" title="You get #VehicleFront.milesinc# miles per day included with your rental. If you go beyond that amount, additional miles are charged at $1.95/mile. If you're planning on covering a lot of distance, buy additional miles now for a discount!">Pre-purchase and save! <span class="ui-icon ui-icon-info"></span></small>
                </td>
            </tr>
            <tr>
                <td>Email</td>
                <td><cfinput name="email" value="#Reservation.email#" maxlength="255" class="#StructKeyExists(fieldErrors,"email") ? 'field-error' : ''#" /></td>
            </tr>
            <tr class="inline-password">
                <td>Password</td>
                <td><cfinput name="inline_pass" type="password" value="#Reservation.inline_pass#" placeholder="(If returning customer)" class="#StructKeyExists(fieldErrors,"login_pass") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Discount/Coupon Code</td>
                <td><cfinput name="coupon" value="#Reservation.coupon#" maxlength="20" placeholder="(Optional)" class="#StructKeyExists(fieldErrors,"coupon") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td class="align-top">Notes/Requests</td>
                <td><cftextarea name="notes" class="#StructKeyExists(fieldErrors,"notes") ? 'field-error' : ''#">#Reservation.notes#</cftextarea></td>
            </tr>

            <cfif NOT IsDefined("IdentityResult") OR NOT IdentityResult.success OR (IsDefined("LoginResult") AND NOT LoginResult.success)>
            <tr class="buttons">
                <td></td>
                <td>
                    <button type="submit" name="identity_btn" class="btn reserve-rental-identity-btn">Continue</button>
                    <div class="spinner next-form-spinner identity-spinner"></div>
                </td>
            </tr>
            </cfif>
        </table>

    </div>

    <div class="exception hidden" id="reservation_identity_error">
        <h3>An error occurred</h3>
        <p class="alert-message"></p>
    </div>

    <div id="reservation_new_user" class="hidden">

        <p class="reservation-info">
        Please create a password. This will allow you to submit your information securely and at your leisure.
        </p>

        <table class="inputform password">
            <tr>
                <td>Password</td>
                <td><cfinput name="create_pass" type="password" value=""></td>
            </tr>
            <tr class="buttons">
                <td></td>
                <td>
                    <button type="button" class="btn reserve-createpass-btn">Continue</button>
                    <div class="spinner next-form-spinner createpass-spinner"></div>
                </td>
            </tr>
        </table>

    </div>

    <div id="reservation_existing_user" class="hidden">

        <p class="reservation-info">
        Welcome back! Please enter your password and your reservation will be processed immediately.
        </p>

        <div id="price_breakdown_existing_user">
        <table class="price-breakdown small-item-data">
            <tr>
                <td>Rental total (<span class="price-numdays"></span>)</td>
                <td>$<span class="price-rental-total"></span></td>
                <td></td>
            </tr>
            <tr class="multiday">
                <td>Multi-Day Discount (<span class="price-multi-day-discount-pct"></span>%)</td>
                <td>- $<span class="price-multi-day-discount"></span></td>
                <td></td>
            </tr>
            <tr>
                <td>Coupon Discount</td>
                <td>- $<span class="price-car-discount"></span></td>
                <td></td>
            </tr>
            <tr class="customer-discount">
                <td>Promotional Discount</td>
                <td>- $<span class="price-customer-discount"></span></td>
                <td></td>
            </tr>
            <tr>
                <td>Extra Miles (<span class="price-extra-miles"></span>)</td>
                <td>$<span class="price-extra-miles-cost"></span></td>
                <td></td>
            </tr>
            <tr>
                <td>Subtotal</td>
                <td>$<span class="price-subtotal"></span></td>
                <td></td>
            </tr>
            <tr>
                <td>Tax (<span class="price-tax-rate"></span>%)</td>
                <td>$<span class="price-tax"></span></td>
                <td></td>
            </tr>
            <tr class="total">
                <td>Total</td>
                <td>$<span class="price-total"></span></td>
                <td></td>
            </tr>
            <tr class="deposit">
                <td>Reservation Deposit</td>
                <td>$<span class="price-reservation-deposit"></span></td>
                <td class="tooltip" title="We will charge your card 50% of the rental total in order to secure your reservation. The remainder will be due at the time you receive the vehicle.">Amount to be charged now <span class="ui-icon ui-icon-info"></span></td>
            </tr>
            <tr class="smallprint">
                <td colspan="3" class="price-delivery-smallprint">
                Delivery may incur additional charges. <span class="delivery-pricing" title="pricing">See pricing <span class="ui-icon ui-icon-info"></span></span>
                </td>
            </tr>
            <tr class="security-deposit">
                <td>Security Deposit</td>
                <td>$<span class="price-security-deposit">#NumberFormat(VehicleFront.deposit,".__")#</span></td>
                <td class="tooltip" title="We require a security deposit of some form of collateral with rentals of our vehicles. This typically is done by placing an authorization (&quot;hold&quot;) on a credit card. This hold is performed 1-2 days prior to the rental date, and is released right after the rental is over. If you would like to use different cards for your rental and your security deposit, you will be able to submit a card for the security deposit after you complete the reservation.">Refundable collateral amount <span class="ui-icon ui-icon-info"></span></td>
            </tr>
        </table>
        </div>

        <table class="inputform password">
            <tr>
                <td>Password</td>
                <td>
                    <cfinput name="login_pass" type="password" value="">
                    <small class="forgot-password dialog-trigger">Forgot?</small>
                </td>
            </tr>

            <tr class="buttons">
                <td></td>
                <td>
                    <button type="button" class="btn reserve-login-btn">Complete Reservation</button>
                    <div class="spinner next-form-spinner password-spinner"></div>
                </td>
            </tr>
        </table>

    </div>

    <div class="exception hidden" id="reservation_password_error">
        <h3>An error occurred</h3>
        <p class="alert-message"></p>
    </div>

    <div id="reservation_payment" <cfif NOT IsDefined("IdentityResult") OR (IsDefined("IdentityResult") AND NOT IdentityResult.success) OR (IsDefined("LoginResult") AND NOT LoginResult.success)>class="hidden"</cfif>>

        <p class="reservation-info">
        We'll need a credit card to secure your reservation. Once the reservation is confirmed, you'll get access to the
        secure PRI Customer Portal, where you can manage your rentals, confirm your insurance information, and specify
        your preferred methods of payment for the rental and the security deposit.
        </p>

        <div id="price_breakdown_new_user"></div>

        <table class="inputform payment">
            <tr>
                <td>First Name</td>
                <td><cfinput name="fname" value="#Reservation.fname#" maxlength="255" class="#StructKeyExists(fieldErrors,"fname") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Last Name</td>
                <td><cfinput name="lname" value="#Reservation.lname#" maxlength="255" class="#StructKeyExists(fieldErrors,"lname") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Mobile Phone</td>
                <td><cfinput name="mphone" value="#Reservation.mphone#" maxlength="20" class="phone #StructKeyExists(fieldErrors,"mphone") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Home Phone</td>
                <td><cfinput name="hphone" value="#Reservation.hphone#" maxlength="20" class="phone #StructKeyExists(fieldErrors,"hphone") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Work Phone</td>
                <td><cfinput name="wphone" value="#Reservation.wphone#" maxlength="20" class="phone #StructKeyExists(fieldErrors,"wphone") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Fax</td>
                <td><cfinput name="fax" value="#Reservation.fax#" maxlength="20" class="phone #StructKeyExists(fieldErrors,"fax") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Credit Card Number</td>
                <td><cfinput name="ccnum" type="tel" value="#Reservation.ccnum#" class="cc-field #StructKeyExists(fieldErrors,"ccnum") ? 'field-error' : ''#" autocomplete="cc-number"></td>
            </tr>
            <tr>
                <td>Credit Card Expiration</td>
                <td>
                    <cfselect name="ccexpmo" class="#StructKeyExists(fieldErrors,"ccexpmo") ? 'field-error' : ''#">
                        <option value="01" <cfif Reservation.ccexpmo IS "01">selected</cfif>>January (01)</option>
                        <option value="02" <cfif Reservation.ccexpmo IS "02">selected</cfif>>February (02)</option>
                        <option value="03" <cfif Reservation.ccexpmo IS "03">selected</cfif>>March (03)</option>
                        <option value="04" <cfif Reservation.ccexpmo IS "04">selected</cfif>>April (04)</option>
                        <option value="05" <cfif Reservation.ccexpmo IS "05">selected</cfif>>May (05)</option>
                        <option value="06" <cfif Reservation.ccexpmo IS "06">selected</cfif>>June (06)</option>
                        <option value="07" <cfif Reservation.ccexpmo IS "07">selected</cfif>>July (07)</option>
                        <option value="08" <cfif Reservation.ccexpmo IS "08">selected</cfif>>August (08)</option>
                        <option value="09" <cfif Reservation.ccexpmo IS "09">selected</cfif>>September (09)</option>
                        <option value="10" <cfif Reservation.ccexpmo IS "10">selected</cfif>>October (10)</option>
                        <option value="11" <cfif Reservation.ccexpmo IS "11">selected</cfif>>November (11)</option>
                        <option value="12" <cfif Reservation.ccexpmo IS "12">selected</cfif>>December (12)</option>
                    </cfselect> /

                    <cfset tyear = #Dateformat(Now(),"yyyy")#>
                    <cfset fyear = tyear+15>
                    <cfset ynow=#LSDateFormat(Now(),"yyyy")#>
                    <cfset ythen=(#ynow# + 11)>
                    <cfset mnow=#LSDateFormat(Now(),"mm")#>
                    <cfset dyear=ynow>
                    <cfselect name="ccexpyr" class="#StructKeyExists(fieldErrors,"ccexpyr") ? 'field-error' : ''#">
                        <cfoutput>
                        <cfloop index="year" from="#ynow#" to="#ythen#">
                            <option value="#dyear#" <cfif Reservation.ccexpyr IS "#dyear#">selected</cfif>>#dyear#</option>>
                            <cfset dyear = dyear + 1>
                        </cfloop>
                        </cfoutput>
                    </cfselect>
                </td>
            </tr>
            <tr>
                <td>CVV</td>
                <td><cfinput name="cccvv" value="#Reservation.cccvv#" style="width: 70px;" class="#StructKeyExists(fieldErrors,"cccvv") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td>Credit Card Bank Phone</td>
                <td>
                    <cfinput name="cctel" value="#Reservation.cctel#" maxlength="20" class="phone #StructKeyExists(fieldErrors,"cctel") ? 'field-error' : ''#" />
                    <small class="tooltip" title="We need the customer service contact phone number shown on the back of your card so that we can verify the card if necessary, and to refund the security deposit after the rental is over."><span class="ui-icon ui-icon-info"></span></small>
                </td>
            </tr>
            <tr>
                <td class="align-top">Street Address</td>
                <td><cftextarea name="addr" style="height: 50px;" class="#StructKeyExists(fieldErrors,"addr") ? 'field-error' : ''#">#Reservation.addr#</cftextarea></td>
            </tr>
            <tr>
                <td>City</td>
                <td><cfinput name="city" value="#Reservation.city#" maxlength="150" class="#StructKeyExists(fieldErrors,"city") ? 'field-error' : ''#" /></td>
            </tr>
            <tr>
                <td class="label">State</td>
                <td>
                    <cfselect name="state" data-stripe="address_state" class="#StructKeyExists(fieldErrors,"state") ? 'field-error' : ''#">
                    <CFLOOP ARRAY="#states#" INDEX="state">
                        <CFOUTPUT><option value="#state.abbr#" <cfif Reservation.state IS "#state.abbr#">selected</cfif>>#state.name#</option></CFOUTPUT>
                    </CFLOOP>
                    </cfselect>
                </td>
            </tr>
            <tr>
                <td class="label">ZIP</td>
                <td><cfinput name="zip" value="#Reservation.zip#" style="width: 100px;" maxlength="10" class="#StructKeyExists(fieldErrors,"zip") ? 'field-error' : ''#" /></td>
            </tr>

            <tr class="buttons">
                <td></td>
                <td>
                    <button type="submit" name="payment_btn" class="btn reserve-rental-complete-btn">Complete Reservation</button>
                    <div class="spinner next-form-spinner payment-spinner"></div>
                </td>
            </tr>
        </table>

    </div>

    <div class="exception hidden" id="reservation_payment_error">
        <h3>An error occurred</h3>
        <p class="alert-message"></p>
    </div>

    </div>

    </cfoutput>
    <cfinput name="customerid" type="hidden" value="" />
    <cfinput name="reservation_type" type="hidden" value="rental" />
    <cfinput name="taxpct" type="hidden" value="" />
    </cfform>

</div>
</div>
{% endblock %}
</section>


<div class="dialog" id="dialog_reset_password" title="Reset Password">
<p>We will send you an email with a link to click on to receive your new password.</p>
</div>

<div class="dialog" id="dialog_reset_password_done" title="Reset Password">
<p>An email has been sent to you containing a link to follow to receive your new password. Afterwards, please return here to continue with your reservation.</p>
</div>

<div id="delivery_pricing" style="display: none;">
    <p>We deliver our vehicles to most locations within the New York City tri-state area. Delivery rates are as follows:</p>
    <table class="small-item-data delivery-pricing" style="margin-left: 0px;">
        <tr>
            <td>Rockland County</td>
            <td>Free</td>
       </tr>
       <tr>
            <td>Manhattan*</td>
            <td>Free</td>
       </tr>
       <tr>
            <td>Westchester Airport</td>
            <td>Free</td>
       </tr>
       <tr>
            <td>Orange County (south of Newburgh)</td>
            <td>Free</td>
       </tr>
       <tr>
            <td>Northern NJ / Bergen / Passaic County</td>
            <td>Free</td>
       </tr>
       <tr>
            <td>Metro NYC / JFK / LGA*</td>
            <td>$99 each way</td>
       </tr>
       <tr>
            <td>Long Island / Connecticut</td>
            <td>$139 each way</td>
       </tr>
       <tr>
            <td>South NJ / Philadelphia</td>
            <td>$159 each way</td>
       </tr>
       <tr>
            <td>Other areas</td>
            <td>$2.00 / mile</td>
       </tr>
    </table>
    <p>
* Due to the nature of Manhattan and the NYC metro area, some locations may be difficult for us to deliver a vehicle due to parking or
standing regulations. In such case we may pick you up and transport you to a suitable location at which to conduct the vehicle
familiarization process and any required paperwork.
    </p>
</div>

    <div class="push"></div>
</div>

<CFINCLUDE TEMPLATE="inc_footer.cfm">
