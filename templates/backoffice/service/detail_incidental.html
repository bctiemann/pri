{% extends "backoffice/service/base.html" %}

{% block content %}

    {% if incidentalservice %}
        <h2>Edit Incidental Service</h2>
    {% else %}
        <h2>Add Incidental Service</h2>
    {% endif %}

    {% include "backoffice/includes/form_error.html" %}

    {% if incidentalservice %}
        <form method="POST" action="{% url "backoffice:service-detail-incidental" pk=incidentalservice.id %}">
    {% else %}
        <form method="POST" action="{% url "backoffice:service-create-incidental" %}">
    {% endif %}

    <table class="inputform service">
        <tr>
            <td>Vehicle</td>
            <td>
                {{ form.vehicle }}
                <cfquery name="Vehicles" datasource="#DSN#">
                    SELECT vehicleid,make,model,year,type FROM Vehicles
                    ORDER BY make,model,year
                </cfquery>
                <cfselect name="vehicleid">
                    <cfloop query="Vehicles">
                        <option value="#vehicleid#" <cfif vehicleid IS ServiceHist.vehicleid>selected</cfif>>#make# #model#</option>
                    </cfloop>
                </cfselect>
            </td>
        </tr>
        <tr>
            <td>Service</td>
            <td>
                {{ form.title }}
                <cfinput name="title" value="#ServiceHist.title#" maxlength="255" />
            </td>
        </tr>
        <tr>
            <td>Done On</td>
            <td>
                {{ form.done_on }}
                <cftry>
                    <cfset stamp = DateFormat(ServiceHist.stamp,"MM/DD/YYYY")>
                    <cfcatch type="Any">
                        <cfset stamp = "">
                    </cfcatch>
                </cftry>
                <cfinput name="stamp" value="#stamp#" maxlength="20" class="short" />
            </td>
        </tr>
        <tr>
            <td>Mileage</td>
            <td>
                {{ form.mileage }}
                <cfinput name="mileage" value="#ServiceHist.mileage#" maxlength="20" class="short" />
            </td>
        </tr>
        <tr>
            <td class="align-top">Notes</td>
            <td>
                {{ form.notes }}
                <cftextarea name="notes">#ServiceHist.notes#</cftextarea>
            </td>
        </tr>

        <tr>
            <td></td>
            <td>
                <button class="btn" type="submit" name="edit">
                    {% if incidentalservice %}
                        Edit
                    {% else %}
                        Add
                    {% endif %}
                </button>
                {% if incidentalservice %}
                <cfif tolltagid>
                    <button
                        class="btn delete"
                        type="submit"
                        name="delete"
                        onclick="return confirmDelete(this.form, '{% url "backoffice:service-delete-incidental" pk=incidentalservice.id %}', 'service log item')"
                    >
                        Delete Service Log Item
                    </button>
                </cfif>
                {% endif %}
            </td>
        </tr>
    </table>
    {% csrf_token %}
    </form>

{% endblock %}